<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
    <link rel="manifest" href="manifest.json"/>
    <meta name="theme-color" content="#007bff"/>
    <link rel="icon" href="icon-192.png"/>
    <title>Buku Tamu Digital</title>
    <style>
        /* ... (style sebelumnya tetap sama sampai bagian modal) ... */

        /* Modal Foto - PERUBAHAN UTAMA: Horizontal pada layar cukup besar */
        #dualCameraFrame {
            display: flex;
            flex-direction: column;        /* Default: vertikal untuk HP */
            gap: 15px;
            width: 100%;
            max-width: 800px;
            margin: 10px auto;
        }

        .camera-view {
            width: 100%;
            border: 2px solid #007bff;
            aspect-ratio: 4/3;
            overflow: hidden;
            position: relative;
            border-radius: 8px;
        }

        .camera-view video, .camera-view img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Horizontal pada layar â‰¥ 600px */
        @media (min-width: 600px) {
            #dualCameraFrame {
                flex-direction: row;       /* HORIZONTAL */
                justify-content: center;
            }
            .camera-view {
                width: 48%;
                max-width: 400px;
            }
        }

        /* ... (style lainnya tetap sama) ... */
    </style>
</head>
<body>
    <!-- ... (bagian body sampai script tetap sama sampai fungsi exportData) ... -->

    <script>
        // ... (semua kode sebelumnya tetap sama sampai fungsi exportData) ...

        function exportData() {
            if (dataBukuTamu.length === 0) {
                alert('Tidak ada data untuk di-export!');
                return;
            }

            // Header CSV yang lebih rapi dan sesuai urutan form
            const header = [
                "No",
                "Nama",
                "Asal (Instansi/Masyarakat)",
                "Instansi/Unit Kerja",   // hanya terisi jika INSTANSI
                "Kecamatan",             // hanya terisi jika MASYARAKAT
                "Desa/Tiyuh",            // hanya terisi jika MASYARAKAT
                "Pihak yang Ditemui",
                "Jenis Layanan",
                "Uraian",
                "Nomor HP",
                "Waktu Kunjungan"
            ];

            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += header.join(",") + "\r\n";

            dataBukuTamu.forEach((data, index) => {
                const row = [
                    index + 1,
                    data.nama,
                    data.asal,
                    data.instansi || "",           // kosong jika bukan INSTANSI
                    data.kecamatan || "",          // kosong jika bukan MASYARAKAT
                    data.desa || "",               // kosong jika bukan MASYARAKAT
                    data.pihakDitemui,
                    data.jenisLayanan,
                    data.uraian,
                    data.nomorHp,
                    data.timestamp
                ];

                // Escaping yang baik: tambahkan kutip jika ada koma atau kutip di dalam nilai
                const escapedRow = row.map(field => {
                    const str = String(field).trim();
                    if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                        return `"${str.replace(/"/g, '""')}"`;
                    }
                    return str;
                });

                csvContent += escapedRow.join(",") + "\r\n";
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `buku_tamu_inspektorat_tubaba_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            alert('Data berhasil di-export ke file CSV!\nFile akan terbuka rapi di Excel/Google Sheets.');
        }

        // ... (sisa script tetap sama) ...
    </script>
</body>
</html>
