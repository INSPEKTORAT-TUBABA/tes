<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#007bff" />
<link rel="icon" href="icon-192.png" />

<title>Buku Tamu Digital</title>
<style>
    /* Mengatur Box Model untuk Tata Letak Responsif */
    *, *::before, *::after { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      overflow-x: hidden;
    }
    body { 
      font-family: sans-serif; 
      max-width: 700px; 
      margin: auto; 
      padding: 20px 10px;
      min-height: 100vh;
    }
    
    label { font-weight: bold; }
    select, input, textarea { 
      width: 100%; 
      padding: 6px; 
      margin-top: 5px; 
    }
    .hidden { display: none; }
    .required { color: red; }
    .error { border: 2px solid red; }
    .success { border: 2px solid green; }
    .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; margin: 10px 0; border-radius: 5px; }
    
    /* Tombol Sticky: Kembali ke Layar Utama */
    #btnHome {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #ffc107;
      color: black;
      border: none;
      padding: 12px 16px;
      border-radius: 50px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      font-size: 16px;
      z-index: 9999;
    }
    #btnHome:hover { background: #e0a800; }
    @media (min-width: 768px) { #btnHome { display: none; } }
    
    /* Penyesuaian untuk tampilan data agar responsif */
    .data-card {
      border: 1px solid #ddd;
      margin-bottom: 15px;
      padding: 15px;
      border-radius: 8px;
      background: #f9f9f9;
    }
    .data-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }
    @media (min-width: 500px) { .data-grid { grid-template-columns: 1fr 1fr; } }
    .data-images {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 15px;
    }
    @media (min-width: 500px) { .data-images { flex-direction: row; } }
    
    #signature-pad, #capturedPhoto {
      max-width: 100%;
      height: auto;
      width: 100%;
    }
   .header-gambar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 15px;
      text-align: center;
      flex-wrap: nowrap;
    }
    .foto-kepala {
      width: 80px;
      height: auto;
    }
    .logo {
      width: 100px;
      height: auto;
    }
    
    /* ---- STYLE UNTUK MODAL FOTO BARU ---- */
    #photoModal {
      display: none; /* Awalnya sembunyi */
      position: fixed;
      z-index: 10000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 10px;
    }
    #modalContent {
      position: relative;
      background-color: #fefefe;
      margin: auto;
      padding: 10px;
      border: 1px solid #888;
      width: 90%;
      max-width: 500px;
      text-align: center;
      border-radius: 8px;
    }
    #cameraFrame {
      position: relative;
      width: 100%;
      max-width: 480px; /* Lebar maksimal bingkai */
      height: auto;
      aspect-ratio: 4/3; /* Rasio standar 4:3 */
      border: 5px solid #007bff; /* Bingkai biru */
      margin: 10px auto;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #videoElement, #capturedPhoto {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    #modalButtons {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    #modalButtons button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    .btn-camera { background: #ffc107; color: black; }
    .btn-save { background: #28a745; color: white; }
    .btn-cancel { background: #dc3545; color: white; }
    .btn-camera:hover { background: #e0a800; }
    .btn-save:hover { background: #218838; }
    .btn-cancel:hover { background: #c82333; }
</style>
</head>
<body>

<div class="header-gambar">
  <img src="bupati.png" alt="Wakil Bupati" class="foto-kepala">
  <img src="logo-tubaba.png" alt="Logo Tubaba" class="logo">
  <img src="wakil-bupati.png" alt="Bupati" class="foto-kepala">
</div>

<h1 style="text-align: center;">BUKU TAMU INSPEKTORAT TUBABA</h1>

<div id="formSection">
<form id="bukuTamuForm">
<div id="nama-section">
<label>Nama: <span class="required">*</span></label>
<input id="nama" required type="text"/><br/><br/>
</div>

<div id="asal-section" class="hidden">
<label>INSTANSI/ASAL: <span class="required">*</span></label>
<select id="asal" required>
<option value="">-- Pilih Asal --</option>
<option value="INSTANSI">INSTANSI/UNIT KERJA</option>
<option value="MASYARAKAT">MASYARAKAT</option>
</select><br/><br/>
</div>

<div class="hidden" id="daftarInstansi">
<label>DAFTAR INSTANSI/UNIT KERJA: <span class="required">*</span></label>
<select id="instansi">
<option value="">-- Pilih Instansi --</option>
<option>SEKRETARIAT DAERAH</option>
<option>SEKRETARIAT DPRD</option>
<option>BADAN PERENCANAAN PEMBANGUNAN DAERAH</option>
<option>BADAN PENGELOLAAN KEUANGAN DAN ASET DAERAH</option>
<option>BADAN PENGELOLAAN PAJAK DAN RETRIBUSI DAERAH</option>
<option>BADAN KEPEGAWAIAN DAN PENGEMBANGAN SUMBER DAYA MANUSIA</option>
<option>BADAN KESATUAN BANGSA DAN POLITIK DAERAH</option>
<option>BADAN PENANGGULANGAN BENCANA DAERAH</option>
<option>DINAS LINGKUNGAN HIDUP</option>
<option>DINAS KESEHATAN</option>
<option>DINAS KEPENDUDUKAN DAN PENCATATAN SIPIL</option>
<option>DINAS KOPERASI, UMKM, PERINDUSTRIAN DAN PERDAGANGAN</option>
<option>DINAS SOSIAL</option>
<option>DINAS PEMUDA, OLAHRAGA DAN PARIWISATA</option>
<option>DINAS KOMUNIKASI DAN INFORMATIKA</option>
<option>DINAS PERUMAHAN, KAWASAN PERMUKIMAN DAN PERTANAHAN</option>
<option>DINAS PENANAMAN MODAL DAN PELAYANAN PERIZINAN TERPADU SATU PINTU</option>
<option>DINAS PENDIDIKAN DAN KEBUDAYAAN</option>
<option>DINAS KETAHANAN PANGAN</option>
<option>DINAS PEMBERDAYAAN MASYARAKAT DAN TIYUH</option>
<option>DINAS PEMBERDAYAAN PEREMPUAN DAN PERLINDUNGAN ANAK</option>
<option>DINAS PENGENDALIAN PENDUDUK DAN KELUARGA BERENCANA</option>
<option>DINAS PERHUBUNGAN</option>
<option>DINAS PERTANIAN</option>
<option>DINAS PETERNAKAN DAN KESEHATAN HEWAN</option>
<option>DINAS PEKERJAAN UMUM DAN PENATAAN RUANG</option>
<option>DINAS TENAGA KERJA DAN TRANSMIGRASI</option>
<option>DINAS PERIKANAN</option>
<option>DINAS PERPUSTAKAAN DAN KEARSIPAN</option>
<option>DINAS PEMADAM KEBAKARAN DAN PENYELAMATAN</option>
<option>SATUAN POLISI PAMONG PRAJA</option>
<option>BADAN PENGAWASAN KEUANGAN DAN PEMBANGUNAN (BPKP)</option>
<option>LAINNYA</option>
</select><br/><br/>
</div>

<div class="hidden" id="daftarMasyarakat">
<label>Kecamatan: <span class="required">*</span></label>
<select id="kecamatan">
<option value="">-- Pilih Kecamatan --</option>
<option value="Tulang Bawang Tengah">Tulang Bawang Tengah</option>
<option value="Tulang Bawang Udik">Tulang Bawang Udik</option>
<option value="Gunung Terang">Gunung Terang</option>
<option value="Gunung Agung">Gunung Agung</option>
<option value="Lambu Kibang">Lambu Kibang</option>
<option value="Way Kenanga">Way Kenanga</option>
<option value="Tumijajar">Tumijajar</option>
<option value="Pagar Dewa">Pagar Dewa</option>
<option value="Batu Putih">Batu Putih</option>
</select><br/><br/>

<label>Desa/Tiyuh: <span class="required">*</span></label>
<select id="desa">
<option value="">-- Pilih Desa --</option>
</select><br/><br/>
</div>

<div id="pihakDitemui-section" class="hidden">
<label>PIHAK YANG DITEMUI: <span class="required">*</span></label>
<select id="pihakDitemui" required>
<option value="">-- Pilih Pihak yang Ditemui --</option>
<option>INSPEKTUR</option>
<option>SEKRETARIS</option>
<option>IRBANSUS</option>
<option>IRBAN 1</option>
<option>IRBAN 2</option>
<option>IRBAN 3</option>
<option>IRBAN 4</option>
</select><br/><br/>
</div>

<div id="jenisLayanan-section" class="hidden">
<label>JENIS LAYANAN: <span class="required">*</span></label>
<select id="jenisLayanan" required>
<option value="">-- Pilih Jenis Layanan --</option>
<option>Permintaan Audit/Klarifikasi Khusus</option>
<option>Penanganan Pengaduan</option>
<option>Layanan Informasi Publik</option>
<option>Pembinaan & Konsultasi</option>
<option>Audit</option>
<option>Review</option>
<option>Evaluasi/Monitoring</option>
<option>Tindak Lanjut Temuan</option>
</select><br/><br/>
</div>

<div id="uraian-section" class="hidden">
<label>URAIAN: <span class="required">*</span></label>
<textarea id="uraian" required oninput="autoResize(this)" style="overflow:hidden; resize:none; width:100%; min-height:60px;"></textarea><br/><br/>
</div>

<div id="nomorHp-section" class="hidden">
<label>NOMOR HP: <span class="required">*</span></label>
<input id="nomorHp" inputmode="numeric" pattern="\d*" required type="text"/><br/><br/>
</div>

<div id="signature-section" class="hidden">
<label>Tanda Tangan: <span class="required">*</span></label>
<div class="warning" id="signatureWarning" style="display:none;">‚ö†Ô∏è Tanda tangan wajib diisi!</div>
<canvas height="200" id="signature-pad" style="border:1px solid #ccc; width: 100%;" width="700"></canvas><br/>
<button onclick="clearSignature()" type="button">üßπ Bersihkan Tanda Tangan</button><br/><br/>
</div>

<div id="photo-section" class="hidden">
<label>Foto: <span class="required">*</span></label>
<div class="warning" id="photoWarning" style="display:none;">‚ö†Ô∏è Foto wajib diambil!</div>

<div id="photo-status">
    <span id="photoStatusText" style="font-weight: bold;"></span>
</div>
<br/>

<button type="button" id="btnAmbilFotoSimpan" onclick="bukaKamera()" style="font-size: 16px;">üì∏ Ambil Foto & Simpan</button>
</div>
</form>
</div>
<div style="margin-bottom: 20px;">
<button type="button" onclick="showForm()" id="btnForm" style="background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin-right: 10px;">üìù Form Input</button>
<button type="button" onclick="showData()" id="btnData" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin-right: 10px;">üìä Lihat Data (<span id="dataCount">0</span>)</button>
<button type="button" onclick="exportData()" style="background: #17a2b8; color: white; padding: 10px 20px; border: none; border-radius: 5px;">üíæ Export Data</button>
</div>

<div id="dataSection" style="display: none;">
<h2>üìä DATA BUKU TAMU</h2>
<div style="margin-bottom: 20px;">
<button type="button" onclick="clearAllData()" style="background: #dc3545; color: white; padding: 8px 15px; border: none; border-radius: 5px;">üóëÔ∏è Hapus Semua Data</button>
</div>
<div id="dataContainer">
<p style="text-align: center; color: #666;">Belum ada data yang tersimpan</p>
</div>
</div>

<div id="photoModal">
    <div id="modalContent">
        <h3 style="color: black;">Bingkai Pengambilan Foto</h3>
        <div id="cameraFrame">
            <video id="videoElement" autoplay muted playsinline style="display:block;"></video>
            <img id="capturedPhoto" alt="Hasil Foto" style="display:none;">
        </div>
        <canvas id="canvasFoto" style="display:none;"></canvas>
        <div id="modalButtons">
            <button type="button" id="btnSimpanLihatData" class="btn-save" onclick="simpanFotoLangsung()">‚úÖ Simpan & Lihat Data</button>
            <button type="button" id="btnTutupModal" class="btn-cancel" onclick="tutupModal()">‚ùå Tutup</button>
        </div>
    </div>
</div>
